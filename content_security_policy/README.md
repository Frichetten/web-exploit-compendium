# Content Security Policy

## What is a CSP?
A content security policy is an important web application security tool that helps prevent XSS as well as some injection attacks. When an attacker exploits XSS, they are injecting their own malicious JavaScript code into the victim's browser. CSP helps us define where scripts can originate safely.

## How does it work?
There are two ways to implement Content Security Policy. The first (and preferred) method is to set it as a response header. The server will issue the CSP header with a `policy` as defined by the developer.  

The second way to implement a Content Security Policy is to provide it as a `<meta>` tag in the html of the page. Please note that this is not the best way to do this as the policy will not apply to <a href="https://developers.google.com/web/fundamentals/security/csp/">frame-ancestors, report-uri, or sandbox</a>.

In the situation where the CSP is defined as a response header and as a meta tag Chrome and Firefox will respect whichever policy is the most restrictive.

## How to implement a CSP
A Content Security Policy works by whitelisting trusted domains. By doing this, if an attacker finds an XSS flaw, they (theoretically) will not be able to exploit it so long as the CSP blocks inline JavaScript. In addition to preventing malicious JavaScript injection, a CSP is also capable of regulating a wide variety of web resources. The following is a list provided by https://content-security-policy.com.  

<ul>
  <li>default-src: The default-src is the default policy for loading content such as JavaScript, Images, CSS, Fonts, AJAX requests, Frames, HTML5 Media.</li>
  <li>script-src: Defines valid sources of JavaScript.</li>
  <li>style-src: Defines valid sources of stylesheets.</li>
  <li>img-src: Defines valid sources of images.</li>
  <li>connect-src: Applies to XMLHttpRequest (AJAX), WebSocket or EventSource. If not allowed the browser emulates a 400 HTTP status code.</li>
  <li>font-src: Defines valid sources of fonts.</li>
  <li>object-src: Defines valid sources of plugins, eg &lt;object&gt;, &lt;embed&gt; or &lt;applet&gt;.</li>
  <li>media-src: Defines valid sources of audio and video, eg HTML5 &lt;audio&gt;, &lt;video&gt; elements.</li>
  <li>frame-src: Defines valid sources for loading frames. `child-src` is preferred over this deprecated directive</li>
  <li>sandbox: Enables a sandbox for the requested resource similar to the iframe sandbox attribute. The sandbox applies a same origin policy, prevents popups, plugins and script execution is blocked. You can keep the sandbox value empty to keep all restrictions in place, or add values.</li>
  <li>report-uri: Instructs the browser to POST reports of policy failures to this URI. You can also append \'-Report-Only\' to the HTTP header name to instruct the browser to only send reports (does not block anything).</li>
  <li>child-src: Defines valid sources for web workers and nested browsing contexts loaded using certain elements.</li>
  <li>form-action: Defines valid sources that can be used as HTML form actions.</li>
  <li>frame-ancestors: Defines valid sources for embedding resources in frames and iframes.</li>
  <li>plugin-types: Defines valid MIME types for plugins invoked via certain elements.</li>
</ul>



## Quick Tips
1. Do not use the deprecated headers "X-Content-Security-Policy" or "X-Webkit-CSP"
2. CSP can be implemented through \<meta\> tags, however do note that this is not the preferred method. Rather, CSP should be implemented through Server Headers.
3. If the CSP is defined both as a response header and as a meta tag, which policy is respected? Chrome and Firefox will respect whichever policy is the most restrictive.

## References / Further Reading
1. https://content-security-policy.com/
2. https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP
3. https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy
4. https://developers.google.com/web/fundamentals/security/csp/ 
